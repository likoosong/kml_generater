import simplekml


class PolygonLatLonAltBoxGenerator(object):

    def __init__(self):

        self.kml = simplekml.Kml()


    def calculate_latlonaltbox(self, coordinates):
        """
        计算边界框最值
        :param coordinates:
        :return:
        """
        # 按纬度（latitude）升序排序
        # 按纬度（latitude）升序排序
        coordinates.sort(key=lambda x: x[1])
        north = coordinates[-1][1]  # 最后一个坐标点具有最大的纬度值
        south = coordinates[0][1]   # 第一个坐标点具有最小的纬度值

        # 按经度（longitude）升序排序
        coordinates.sort(key=lambda x: x[0])
        east = coordinates[-1][0]  # 最后一个坐标点具有最大的经度值
        west = coordinates[0][0]  # 第一个坐标点具有最小的经度值

        return north, south, east, west


    def create_kml(self, coordinates):
        """
        simplekml.Lod: 指定在不同缩放级别下要显示的 KML 元素
            minLodPixels 和 maxLodPixels： 控制不同缩放级别下的显示和隐藏
                minLodPixels: 在此像素大小以下的缩放级别上，KML 元素将始终可见
                maxLodPixels: 在此像素大小以上的缩放级别上，KML 元素将始终隐藏
            minFadeExtent 和 maxFadeExtent 过渡范围内的渐变效果，从完全可见到完全隐藏或从完全隐藏到完全可见
                minFadeExtent: 指定从完全可见到完全隐藏的过渡范围的最小像素值
                maxFadeExtent: 指定从完全隐藏到完全可见的过渡范围的最大像素值
        simplekml.LatLonAltBox: 经纬度和海拔范围来限定地理区域
            north: 纬度的北边界 0 到 90
            south: 纬度的南边界 0 到 90
            east: 经度的东边界  0 到 90
            west: 经度的西边界  0 到 90
            minAltitude: 最小海拔高度(米)
            maxAltitude: 最大海拔高度(米)
            altitudeMode: 海拔模式，指定海拔高度的参考方式，例如相对于地面、相对于海平面等
        :return:
        """

        pol = self.kml.newpolygon(name="Polygon with simple Region")
        pol.style.polystyle.color = simplekml.Color.red  # Set the polygon fill color to red (ABGR format)
        pol.outerboundaryis = coordinates

        region = pol.region

        north, south, east, west = self.calculate_latlonaltbox(coordinates)
        region.latlonaltbox = simplekml.LatLonAltBox(north=north, south=south, east=east, west=west)
        region.lod = simplekml.Lod(minlodpixels=128, maxlodpixels=512 , minfadeextent=64, maxfadeextent=256)


        # region.lod = simplekml.Lod(minlodpixels=400, maxlodpixels=1200)  # , minfadeextent=32, maxfadeextent=128)
        # region.lod = simplekml.Lod(minlodpixels=32, maxlodpixels=64)  # , minfadeextent=32, maxfadeextent=128)

        # region.latlonaltbox.north = north
        # region.latlonaltbox.south = south
        # region.latlonaltbox.east = east
        # region.latlonaltbox.west = west
        # region.lod.minlodpixels = 184
        # region.lod.maxfadeextent = 500
        # region.lod.minfadeextent = 50

    def run(self):


        coordinates = [[111.260813,33.796775],[111.270816,33.781699],[111.288558,33.779702],[111.304223,33.775008],[111.315044,33.764073],[111.322467,33.762974],[111.336245,33.768317],[111.348387,33.764822],[111.390035,33.771264],[111.398906,33.768168],[111.4342,33.747742],[111.469808,33.738052],[111.484529,33.726462],[111.495476,33.725663],[111.516048,33.7405],[111.523975,33.742847],[111.541402,33.733406],[111.567699,33.735005],[111.59148,33.727711],[111.619476,33.730059],[111.645207,33.720517],[111.665151,33.695582],[111.684968,33.677489],[111.719003,33.688885],[111.728629,33.688086],[111.778078,33.666091],[111.819411,33.652892],[111.82759,33.634189],[111.827716,33.606228],[111.832749,33.598723],[111.843444,33.595821],[111.863953,33.599174],[111.884526,33.596121],[111.899184,33.588666],[111.916359,33.572102],[111.930137,33.571051],[111.994182,33.584913],[112.020353,33.587715],[112.028343,33.593019],[112.024191,33.600024],[112.018655,33.59437],[112.012301,33.602626],[112.014943,33.613632],[112.024757,33.622436],[112.038535,33.622386],[112.059044,33.605227],[112.065713,33.607479],[112.087481,33.603076],[112.092199,33.607228],[112.084146,33.628988],[112.076345,33.633689],[112.071312,33.648192],[112.074018,33.653142],[112.104719,33.661392],[112.120573,33.668841],[112.13089,33.676939],[112.141774,33.691634],[112.15033,33.713672],[112.158509,33.720117],[112.168638,33.721766],[112.17776,33.715621],[112.179207,33.703278],[112.184995,33.698731],[112.214752,33.713972],[112.230103,33.71702],[112.239917,33.715321],[112.249354,33.719018],[112.24797,33.72871],[112.263446,33.743596],[112.266907,33.769766],[112.259168,33.776007],[112.260049,33.781849],[112.277413,33.791684],[112.273953,33.801667],[112.285906,33.808755],[112.301383,33.811001],[112.323402,33.828467],[112.351461,33.834605],[112.363854,33.840143],[112.372222,33.838297],[112.40978,33.80591],[112.42381,33.806559],[112.433687,33.810951],[112.45665,33.836451],[112.462312,33.84583],[112.474643,33.855458],[112.48559,33.859848],[112.512768,33.85895],[112.534095,33.880247],[112.541393,33.892165],[112.536423,33.902236],[112.51497,33.906374],[112.502576,33.913004],[112.497858,33.926064],[112.530761,33.937975],[112.538121,33.947344],[112.539065,33.968071],[112.546803,33.979777],[112.547118,33.998304],[112.56964,34.003035],[112.549383,34.016529],[112.533718,34.018122],[112.538625,34.027084],[112.572346,34.043162],[112.577253,34.062373],[112.601222,34.071827],[112.602544,34.088792],[112.608206,34.114209],[112.616196,34.128928],[112.620285,34.143148],[112.611666,34.15816],[112.595623,34.163529],[112.589395,34.18614],[112.583544,34.19096],[112.559763,34.224988],[112.577819,34.246988],[112.575617,34.254336],[112.557876,34.263719],[112.553724,34.27608],[112.569703,34.284815],[112.573226,34.298314],[112.597133,34.317962],[112.613994,34.322328],[112.607262,34.327934],[112.623682,34.337854],[112.650168,34.341078],[112.659605,34.333936],[112.65734,34.320592],[112.669294,34.324908],[112.688356,34.326743],[112.701001,34.335077],[112.73057,34.330414],[112.741265,34.333738],[112.75693,34.330662],[112.776622,34.345046],[112.760076,34.346584],[112.756805,34.357394],[112.732898,34.350898],[112.728117,34.361163],[112.730318,34.377426],[112.721825,34.380152],[112.72409,34.388877],[112.733653,34.39309],[112.735918,34.404242],[112.729626,34.416978],[112.736673,34.422578],[112.741894,34.433973],[112.744285,34.4683],[112.740384,34.491077],[112.767374,34.49479],[112.774609,34.500137],[112.798012,34.487166],[112.806002,34.479243],[112.838024,34.477164],[112.856017,34.478402],[112.862371,34.473648],[112.896155,34.475827],[112.905215,34.468201],[112.922956,34.47657],[112.920125,34.482016],[112.927297,34.499691],[112.925598,34.509789],[112.929813,34.526023],[112.947995,34.531467],[112.976683,34.53117],[112.984736,34.539038],[112.967749,34.541264],[112.952273,34.547647],[112.929562,34.547548],[112.910751,34.545173],[112.890682,34.547102],[112.87898,34.560015],[112.877722,34.567731],[112.864133,34.580146],[112.862183,34.590284],[112.846329,34.58885],[112.839408,34.596514],[112.845574,34.609913],[112.840226,34.623161],[112.82475,34.625188],[112.825001,34.628698],[112.841799,34.628648],[112.847147,34.640362],[112.831041,34.656669],[112.835885,34.667785],[112.829217,34.683346],[112.830223,34.694163],[112.8496,34.699694],[112.867782,34.708089],[112.879735,34.705077],[112.893827,34.694953],[112.901692,34.693521],[112.91635,34.710953],[112.931764,34.711694],[112.939502,34.72384],[112.909933,34.737465],[112.902258,34.753161],[112.908486,34.757405],[112.909367,34.771123],[112.89993,34.780596],[112.887914,34.782718],[112.875017,34.779659],[112.846329,34.780054],[112.837144,34.782915],[112.817263,34.778278],[112.810595,34.784938],[112.80984,34.7951],[112.814118,34.811475],[112.827266,34.819218],[112.813363,34.832877],[112.78782,34.83761],[112.773288,34.835884],[112.753281,34.828587],[112.72214,34.828833],[112.696723,34.840617],[112.676088,34.853188],[112.656648,34.859645],[112.638215,34.854174],[112.636328,34.88266],[112.642115,34.895717],[112.638152,34.896998],[112.638404,34.919756],[112.618209,34.920298],[112.585369,34.926503],[112.579329,34.933398],[112.578134,34.944083],[112.571654,34.948761],[112.5692,34.958608],[112.563853,34.949696],[112.551207,34.938569],[112.527867,34.932019],[112.519436,34.940341],[112.505155,34.942459],[112.496914,34.921726],[112.511447,34.92084],[112.515976,34.929212],[112.527426,34.929163],[112.537304,34.916013],[112.534221,34.893746],[112.521072,34.892761],[112.505659,34.898821],[112.496536,34.895717],[112.489616,34.90286],[112.462501,34.915668],[112.433247,34.920987],[112.39097,34.918574],[112.384993,34.924533],[112.360268,34.931428],[112.334537,34.941425],[112.3212,34.941375],[112.301068,34.945462],[112.28188,34.960232],[112.267284,34.953537],[112.258099,34.942212],[112.247844,34.940735],[112.226831,34.956589],[112.212047,34.965007],[112.1877,34.972981],[112.169896,35.00241],[112.1514,35.015399],[112.125857,35.021204],[112.108242,35.029222],[112.09352,35.029911],[112.042436,35.027845],[112.035075,35.033845],[112.038912,35.045501],[112.035264,35.053714],[112.023814,35.060843],[112.021171,35.067973],[112.006009,35.065367],[111.973358,35.070234],[111.958699,35.062908],[111.958573,35.0486],[111.939511,35.0366],[111.940203,35.030599],[111.967067,35.014169],[111.991917,35.005018],[111.978139,34.997195],[111.981033,34.990059],[111.967192,34.989912],[111.95763,34.986221],[111.961153,34.975689],[111.983235,34.970471],[111.981914,34.960626],[111.950835,34.947776],[111.933975,34.947678],[111.921707,34.934038],[111.906168,34.929606],[111.890062,34.920347],[111.88396,34.911974],[111.883267,34.894239],[111.898744,34.885912],[111.922336,34.883941],[111.949829,34.863391],[111.948948,34.852301],[111.957944,34.851167],[111.981411,34.857624],[111.990722,34.853779],[111.982858,34.846139],[111.986003,34.837856],[112.01444,34.817985],[112.020731,34.811327],[112.012804,34.803781],[112.016327,34.797073],[112.030105,34.792584],[112.031992,34.782965],[112.031174,34.777735],[112.017459,34.769939],[112.019347,34.762587],[112.011042,34.750644],[111.997831,34.750693],[112.000536,34.745017],[111.995692,34.736823],[112.014125,34.731048],[112.01488,34.724235],[111.997642,34.717125],[111.993238,34.693866],[111.982921,34.695052],[111.984997,34.686013],[111.972855,34.66739],[111.980089,34.654],[111.971408,34.65069],[111.967444,34.64308],[111.953666,34.639521],[111.943223,34.629637],[111.94165,34.620492],[111.928879,34.600272],[111.905664,34.6198],[111.888867,34.61891],[111.863953,34.647082],[111.830736,34.649207],[111.823752,34.646242],[111.821362,34.634431],[111.811296,34.633887],[111.797078,34.626028],[111.778393,34.608331],[111.764112,34.609171],[111.758764,34.597454],[111.740079,34.600272],[111.702835,34.584943],[111.696292,34.575744],[111.687044,34.571886],[111.672008,34.572232],[111.681445,34.547647],[111.692643,34.535673],[111.683584,34.533298],[111.670058,34.540571],[111.619099,34.55576],[111.608089,34.56229],[111.594437,34.565308],[111.584434,34.556057],[111.574305,34.564467],[111.562037,34.558728],[111.544736,34.544925],[111.538634,34.543342],[111.525045,34.54829],[111.5029,34.545074],[111.489437,34.533842],[111.484655,34.525528],[111.45754,34.512561],[111.451689,34.505928],[111.418346,34.490829],[111.394816,34.482016],[111.385065,34.473103],[111.370595,34.473301],[111.358642,34.480333],[111.344424,34.472955],[111.324732,34.471717],[111.306676,34.474193],[111.300008,34.488948],[111.289313,34.485581],[111.271383,34.470677],[111.272012,34.447547],[111.244708,34.453788],[111.227533,34.459732],[111.220235,34.457949],[111.213252,34.437441],[111.21344,34.429812],[111.197712,34.418762],[111.191232,34.41792],[111.188967,34.399286],[111.171415,34.394974],[111.156819,34.394677],[111.147949,34.38853],[111.141217,34.373113],[111.138449,34.35675],[111.141217,34.353031],[111.159839,34.350799],[111.166634,34.344798],[111.16915,34.334878],[111.185444,34.31697],[111.191547,34.301837],[111.181921,34.27876],[111.182488,34.256421],[111.187772,34.250265],[111.180915,34.230203],[111.166571,34.228962],[111.158958,34.223101],[111.175819,34.209541],[111.207401,34.197419],[111.214699,34.181221],[111.234516,34.178537],[111.248671,34.162882],[111.253201,34.15309],[111.267922,34.146528],[111.276856,34.148318],[111.281889,34.138524],[111.296925,34.145137],[111.305292,34.140165],[111.306362,34.125149],[111.313408,34.116546],[111.334735,34.115601],[111.344738,34.109037],[111.358768,34.108788],[111.367198,34.092473],[111.354301,34.084464],[111.342096,34.056053],[111.342285,34.037936],[111.355119,34.015185],[111.353609,33.996263],[111.356,33.984509],[111.344109,33.973351],[111.324795,33.963039],[111.305921,33.941364],[111.303342,33.928207],[111.29013,33.926662],[111.276793,33.935533],[111.259366,33.929852],[111.239989,33.933141],[111.230049,33.924768],[111.226652,33.913104],[111.234768,33.901738],[111.234516,33.894857],[111.212811,33.884087],[111.206017,33.891616],[111.203689,33.883438],[111.21948,33.872766],[111.216397,33.865135],[111.232062,33.856805],[111.240304,33.842488],[111.261568,33.822878],[111.260813,33.796775]]

        self.create_kml(coordinates)

        self.kml.save("generated_kml4.kml")

if __name__ == "__main__":
    pol = PolygonRegionGenerator()
    pol.run()





# https://turfpy.readthedocs.io/en/latest/transformations/bezier_spline.html